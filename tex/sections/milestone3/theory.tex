% !TEX root = ../../main.tex

% ---------------------------------------
% labels: \label{mil3:theo:[type]:[name]}
% ---------------------------------------
% PRESENT/FUTURE TENSE



The geometry of the spacetime is encoded in the Einstein tensor $G\munu$ that relates to the energy-momentum tensor $T\munu$ through the Einstein equation $G\munu = 8\pi G T\munu$. The latter quantity describes the distrubution of energy and matter. The perturbed Einstein equation can be written
\begin{equation}
    \overline{G}\munu +\delta G\munu = 8\pi G \left( \overline{T}\munu+\delta T_{\mu \nu} \right),
\end{equation}
where we use (and will continue to use) an overline to indicate the unperturbed quanity. Being primarily interested in the perturbations, it all boils down to solving
\begin{equation}\label{mil3:theo:eq:delta_G}
    \delta G\munu = 8\pi G\, \delta T\munu
\end{equation}
in a clever way.\footnote{Solving it directly is highly non-trivial.} The metric is related to the Einstein tensor through $G\munu= R\munu - \frac{1}{2}g\munu R^\rho_{\, \rho}$, where $R\munu$ is the Ricci tensor. 
%We will solve differential equations for:
% \begin{itemize}
%     \item spacetime corrections (potentials) $\Psi$ and $\Phi$
%     \item density perturbations to normal matter $\delta\ped{c}$ and $\delta\ped{b}$
% \end{itemize}
Below is presented a short description of the quantities we aim to compute. 
\begin{itemize}
    \item $\Psi$ and $\Phi$ are spacetime corrections (potentials), both closely related to the Newtonian gravitational potential.
    \item $\delta\ped{c}$ and $\delta\ped{b}$ are density perturbations to non-relativistic matter, representing cold dark matter and baryonic matter, respectively.
    \item $u\ped{c}$ and $u\ped{b}$ are velocity perturbations to non-relativistic matter, representing cold dark matter and baryonic matter, respectively.
    \item $\Theta_{\ell= 0, 1, \dots, \ell\ped{max}}$ are the photon multipoles that show up when expanding the photon temperature fluctuations $\Theta$ into spherical harmonics.
\end{itemize}

We will not go into detail in how to get from~\cref{mil3:theo:eq:delta_G} to the set of equations we will eventually use, but rather keep in mind that the quantities $\delta\ped{c,b}$, $u\ped{c,b}$, $\Theta_\ell$, $\Phi$ and $\Psi$ are deduced from the Einstein equation and first order linear perturbation theory. 


Instead of real space $(\vec{x}, t)$, we will work in the Fourier space ($\vec{x}\to\vec{k}$), so that all our quantities will generally be functions of Fourier mode $k=\abs{\vec{k}}$ and our time variable $x = \ln{a(t)}$. That is, a function $f$ of space and time is
\begin{equation}
    f(\vec{x}, t) = \int \frac{d^3 k}{(2\pi)^3} \eu^{\im \vec{k}\cdot \vec{x}}f(\vec{k}, x(t)),
\end{equation}
and will notationally not be distinguished from its Fourier transform. Spatial derivatives of $f(\vec{x}, t)$ become
\begin{equation}
    \pdv{f(\vec{x}, t)}{x^i} \to \im k_i f(\vec{k}, x(t)).
\end{equation}
The direction of the wavevector $\vec{k}$ will be neglected. We let $k=\abs{\vec{k}}$ be the magnitude of a $\vec{k}$-mode. In summary:
\begin{equation}
\begin{split}
    f(\vec{x}, t) &\to f(k, x) \\
    \partial_i f(\vec{x}, t) &\to \im k f(k, x)
\end{split}
\end{equation}

We use the Fourier modes $k$ to classify the physical scales. We separate roughly between three main regimes: those of large-, intermediate- and small-scale modes. A mode enters the horizon when $k\eta(x) \gtrsim 1$, so this happens is later for larger scales (smaller values of $k$). Large-scale modes 

In the following, we spare ourselves the eyesore that is the complete set of equations we will use and save this for~\cref{app:pert}.


% \subsubsection{Two regimes}\label[sec]{mil3:theo:sec:regimes}
    % We will encounter numerical obstacles 
Due to numerical obstacles, it is benefitial to define a regime in the early universe for which some useful approximations are viable. We refer to the situation wherein protons and electrons behave as a single fluid as the ``tight coupling regime''. We define the tight coupling regime to begin at (or prior to) $x=x\ped{init}$ and prolong as long as \cref{mil3:theo:eq:tc_conditions} holds:
\begin{subequations}\label{mil3:theo:eq:tc_conditions}
\begin{align}
    &\abs{\dv{\tau(x)}{x}} > 10 \label{mil3:theo:eq:tc_condition_one} \\
    & \abs{\dv{\tau(x)}{x}} > 10 \frac{ck}{\Hp(x)} \label{mil3:theo:eq:tc_condition_two}\\
    &x \leq -8.3 \ll x_* \label{mil3:theo:eq:tc_condition_three}
\end{align}
\end{subequations}
\cref{mil3:theo:eq:tc_condition_three} ensures that tight coupling ends a fair while before the onset of recombination. 



\subsubsection{Metric perturbations}\label[sec]{mil3:theo:sec:metric_pert}
    The FRW metric from~\cref{mil1:theo:eq:FRW} describes a smooth universe. A first order linear perturbation to the metric can be applied through
    \begin{equation}\label{mil3:theo:eq:xxxxxx}
        g\munu = \overline{g}\munu + h\munu,
    \end{equation}
    where $\overline{g}\munu $ is the zeroth order term---the FRW metric.\footnote{We use the term ``metric'' on both $g\munu$ and $ds^2 = g\munu\diff x^\mu \diff x^\nu$.} We will work the the so-called conformal-Newtonian gauge, where the perturbation $h\munu$ is
    \begin{equation}
    \begin{split}
        h_{00} &= 2\Psi \\
        h_{0i} &= 0 \\
        h_{ij} &= 2\Phi \deltasym{ij}.
    \end{split}
    \end{equation}
    The two potentials $\Psi$ and $\Phi$ are closely related to the Newtonian gravitational potential. Our perturbed metric is now given by
    \begin{equation}
    \begin{split}
        g_{00} &= - \left(1+2\Psi\right) \\
        g_{0i} &= 0 \\
        g_{ij} &= \eu^{2x}\deltasym{ij}\left(1+2\Phi \right).
    \end{split}
    \end{equation}


    % It can be shown \citep[see e.g.][Ch.~4]{Callin2006} that writing
    % \begin{equation}
    %     ds^2 = - (1-)
    % \end{equation}



\subsubsection{Matter perturbations}\label[sec]{mil3:theo:sec:matter}
    The normal matter in the universe is either cold dark or baryonic. We set the perturbed number densities of these species to be
    \begin{equation}\label{mil3:theo:eq:defining_matter_pert}
        n_s =  \overline{n_s} \left[1 + \delta_s\right]\,; \quad s=\mathrm{c,b},
    \end{equation}
    so that $\overline{n_s}\delta_s$ is the leading order term. To zeroth order, we have $\overline{n_s}\propto \eu^{-3x}$ from the Boltzmann equation.

    We denote the fluid (or ``bulk'') velocity of a species $s$ as $\vec{u}_s$, and its longitudinal component as $u_s$, such that
    \begin{equation}
       \vec{u}_s = \vec{u}_s(\vec{k}, x) =  u_s(\vec{k}, x)\frac{\vec{k}}{k}.
    \end{equation}
    In addition, we use the convention that $u_s \to \im u_s$.

    The governing equation for $\delta_s(k,x)$ is the continuity equation for $n_s(k,x)$ to first order. This takes the same form for $s=\mathrm{c}$ and $s=\mathrm{b}$. However, the equation for $u_{s}(k, x)$, the Euler equation, is one term \dots
    % The continuity equation to first order becomes
    % \begin{equation}
    %     \dv{\delta_s}{x}
    % \end{equation}


\subsubsection{Temperature fluctuations}\label[sec]{mil3:theo:sec:temperature}
    We let the momentum of a photon be $\vec{p}$ and its magnitude $p = \abs{\vec{p}}$. Define $\mu\equiv(kp)^{-1} \vec{k}\cdot \vec{p}$. The perturbed photon temperature $T\gped{\textgamma}= T(\vec{k}, \mu, x)$ is 
    \begin{equation}\label{mil3:theo:eq:defining_temperature_pert}
        \Tgamma = \overline{\Tgamma}(x)\left[1 + \Theta(\vec{k}, \mu, x)\right],
    \end{equation}
    where $\overline{\Tgamma}(x) =\TCMB \eu^{-x}$. The photon perturbation $\Theta(\mu)$ can be expanded into multipoles $\Theta_\ell$. The relation is
    % \begin{equation}\label{mil3:theo:eq:multipole_expansion}
    % \begin{split}
    %     \Theta_\ell &= \frac{\im^{\ell}}{2} \int_{-1}^{1}  \dx{\mu}\mathcal{P}_\ell(\mu)\Theta(\mu) \\
    %     \Leftrightarrow \, \Theta(\mu) &= \sum_{\ell=0}^{\ell\ped{max}} \frac{2\ell+1}{\im^{\ell}}\Theta_\ell \mathcal{P}_\ell(\mu)\,; \quad\ell\ped{max} \to \infty,
    % \end{split}
    % \end{equation}
    \begin{equation}\label{mil3:theo:eq:multipole_expansion}
        \Theta_\ell = \frac{\im^{\ell}}{2} \int_{-1}^{1}  \dx{\mu}\mathcal{P}_\ell(\mu)\Theta(\mu) \,
        \Leftrightarrow \, \Theta(\mu) = \sum_{\ell=0}^{\infty} \frac{2\ell+1}{\im^{\ell}}\Theta_\ell \mathcal{P}_\ell(\mu),
    \end{equation}
    where $\mathcal{P}_\ell(\mu)$ are the Legendre polynomials. 

    \citet{Callin2006} explains how one can relate the current value of the temperature multipoles $\Theta_\ell(k, x\!=\!0)$ to the temperature source function $\tilde{S}(k, x)$ and spherical Bessel functions $j_\ell(\xi\!\in\!\mathbb{R})$, eventually obtaining
    \begin{equation}
        \Theta_\ell (k, x\!=\!0) = \int_{-\infty}^{0}\dx{x'} \tilde{S}(k,x') \cdot j_\ell(k \left[\eta_0 - \eta(x')\right]),
    \end{equation}
    where
    \begin{equation}\label{mil3:theo:eq:source_function}
    \begin{split}
        \tilde{S} =& \gti \left[\Theta_0 + \Psi + \frac{1}{4}\Theta_2\right] + \eu[-\tau]\left[ \dv{\Psi}{x} -\dv{\Phi}{x} \right] \\
        &- \frac{1}{ck} \dv{}{x}\left(\Hp \gti u\ped{b} \right) + \frac{3}{4c^2k^2}\dv{}{x}\left[ \Hp \dv{}{x}\left(\Hp \gti\Theta_2 \right)  \right].
    \end{split}
    \end{equation}

    Using this so-called line-of-sight integration method, it seems we can compute all $\Theta_{\ell>2}$ given $\Theta_{\ell\leq 2}$. However, after tight coupling, the evolution of a multipole $\Theta_\ell$ depends on both $\Theta_{\ell-1}$ and $\Theta_{\ell+1}$. That is to say, to compute $\Theta_2$, we need $\Theta_3$ for which we need $\Theta_4$, and so on. The Boltzmann hierachy cutoff provides a solution to this apperent issue. The method allows us to only include $\ell=0, 1, \dots, \ell\ped{max}\!\sim\! 6$ when solving the differential equations in~\cref{app:pert:eq:photon_multipoles} by treating $\Theta_{\ell\ped{max}}$ slightly different. 
    

